<!-- Only the relevant logic updated for brevity. This is a drop-in replacement for your file. -->
<!DOCTYPE html>
<html lang="en">
<head>
    ...
    <style>
        body { ... }
        /* ...other styles... */
        @media (max-width: 767px) {
            #visualization {
                position: fixed !important;
                top: 24px !important;
                left: 0 !important;
                right: 0 !important;
                width: 100vw !important;
                z-index: 20 !important;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.4s;
            }
            #visualization.show-visual {
                opacity: 1 !important;
                pointer-events: auto;
            }
            #visualization.hide-visual {
                opacity: 0 !important;
                pointer-events: none !important;
            }
            /* ...other mobile styles... */
        }
        /* ...desktop styles... */
    </style>
</head>
<body class="antialiased">
    <!-- ... -->
    <header class="text-center p-8 bg-gray-900/50 backdrop-blur-sm z-20">
        <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight">DokuFest Ticket Sales Analysis</h1>
        <p class="text-lg text-gray-400 mt-1">A Three-Year Journey: 2023-2025</p>
    </header>
    <!-- ...main content... -->
    <main class="container mx-auto px-4 md:px-8">
        <!-- ...intro, scrollytelling, etc... -->
        <section id="recommendations" class="py-14 border-t border-gray-800">
            <div class="max-w-4xl mx-auto">
                <h2 id="yearonyear-header" class="text-4xl font-bold text-center text-white mb-4">Year-on-Year Comparison & Strategy</h2>
                <!-- ...rest unchanged... -->
            </div>
        </section>
    </main>
    <footer class="text-center p-8 mt-12 border-t border-gray-800">
        <p class="text-gray-500">Scrollytelling Analysis | Powered by Data</p>
    </footer>

    <script>
        gsap.registerPlugin(ScrollTrigger);

        // ...existing visualization/data logic...

        // Mobile visualization show/hide logic: hide when Year-on-Year heading reaches visualization's bottom
        function mobilePinSetup() {
            if (window.innerWidth > 767) {
                visualization.classList.add('show-visual');
                visualization.classList.remove('hide-visual');
                return;
            }
            visualization.classList.remove('show-visual');
            visualization.classList.remove('hide-visual');

            // Show visual when arrow is out of view
            ScrollTrigger.create({
                trigger: introArrow,
                start: "bottom top",
                onEnter: () => {
                    visualization.classList.add('show-visual');
                    visualization.classList.remove('hide-visual');
                },
                onLeaveBack: () => {
                    visualization.classList.remove('show-visual');
                    visualization.classList.remove('hide-visual');
                }
            });

            // Hide visual when Year-on-Year heading's top touches visualization's bottom
            ScrollTrigger.create({
                trigger: yearOnYearHeader,
                start: () => {
                    // calculate the offset where visualization's bottom meets window top
                    const viz = visualization;
                    const topOffset = 24; // match CSS top
                    // Get height of visualization box (may need to query .max-w-md inside it)
                    const vizInner = viz.querySelector('.max-w-md');
                    const vizHeight = vizInner ? vizInner.offsetHeight : viz.offsetHeight;
                    // scrollTrigger start syntax: "top top+=[pixels]"
                    // So, when yearOnYearHeader's top is at (topOffset + vizHeight) from top
                    return "top+=" + (topOffset + vizHeight) + "px top";
                },
                onEnter: () => {
                    visualization.classList.remove('show-visual');
                    visualization.classList.add('hide-visual');
                },
                onLeaveBack: () => {
                    visualization.classList.remove('hide-visual');
                    visualization.classList.add('show-visual');
                }
            });
        }

        // Run pin logic on load and resize
        window.addEventListener('DOMContentLoaded', () => {
            mobilePinSetup();
        });
        window.addEventListener('resize', () => {
            ScrollTrigger.refresh();
            mobilePinSetup();
        });
    </script>
</body>
</html>